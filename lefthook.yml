output: false

pre-commit:
  parallel: true
  commands:
    biome:
      glob: "*.{ts,tsx,js,jsx,json,css}"
      run: bunx @biomejs/biome check --write {staged_files}
      stage_fixed: true
    cargo-fmt:
      glob: "*.rs"
      exclude: "**/target/**"
      root: "src-tauri/"
      run: cargo fmt
    cargo-check:
      glob: "*.rs"
      exclude: "**/target/**"
      root: "src-tauri/"
      run: cargo check
    cargo-clippy:
      glob: "*.rs"
      exclude: "**/target/**"
      root: "src-tauri/"
      run: cargo clippy -- -D warnings
    final-newline:
      glob: "*.{ts,tsx,js,jsx,json,css,rs,toml,yml,yaml,md,html}"
      run: |
        fail=0
        for f in {staged_files}; do
          [ -f "$f" ] && [ -s "$f" ] && [ "$(tail -c1 "$f" | wc -l)" -eq 0 ] && echo "Missing final newline: $f" && fail=1
        done
        exit $fail

commit-msg:
  commands:
    conventional-commit:
      run: 'grep -qE "^(feat|fix|chore|docs|style|refactor|test|build|ci|perf|revert)(\(.+\))?!?: .+" {1} || { echo "Commit message must follow conventional commits: <type>: <description>"; exit 1; }'
    no-co-authored-by:
      run: '! grep -qi "co-authored-by" {1} || { echo "Co-Authored-By trailers are not allowed in commit messages."; exit 1; }'
